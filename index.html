<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>M&M Booking Form</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="form-wrapper">
    <div class="header">
      <img src="logo.png" alt="Logo" class="logo"/>
      <h1>M&M Booking Form</h1>
    </div>

    <form id="orderForm" method="POST">
      <!-- Hidden Fields -->
      <input type="hidden" id="sno" name="SNO" />
      <input type="hidden" id="party" name="PARTY" />
      <input type="hidden" id="district" name="DISTRICT" />
      <input type="hidden" id="state" name="STATE" />
      <input type="hidden" id="phone" name="PHONE" />

      <!-- Visible locked fields -->
      <div class="form-group">
        <label>Catalogue Number</label>
        <input type="text" id="catalogue" name="CATALOGUE" readonly />
      </div>

      <div class="form-group">
        <label>Price</label>
        <input type="text" id="price" name="PRICE" readonly />
        <small class="help-text">Locked from Google Sheet</small>
      </div>

      <!-- PDF Embed -->
      <div class="form-group">
        <label>Catalog Preview</label>
        <div id="pdf-container">
          <iframe id="pdf-frame" src="" frameborder="0"></iframe>
          <a id="pdf-link" href="#" target="_blank" class="pdf-button">Open Document</a>
        </div>
      </div>

      <!-- User input -->
      <div class="form-group">
        <label for="quantity">How Many Bundles Do You Want?</label>
        <input type="number" id="quantity" name="QUANTITY" min="1" required />
      </div>

      <button type="submit" class="submit-btn">Submit Order</button>
    </form>
  </div>

  <script>
    // üîó Replace with your published sheet CSV link
    const PUBLISHED_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1pLlIrZzcYxv-LX0iOgel0qsIDoXSHdvRW8fDio_dbSM/edit?gid=1008240067#gid=1008240067";
    const SUBMIT_URL = "https://formspree.io/f/xjkelgaq";

    // Load data from sheet
    async function loadSheetData() {
      try {
        const res = await fetch(PUBLISHED_SHEET_CSV_URL);
        const csv = await res.text();
        const rows = csv.trim().split("\n").map(r => r.split(","));

        // Example mapping (adjust if needed):
        // A7:E7 => sno, party, district, state, phone
        const snoVal = rows[6][0];
        const partyVal = rows[6][1];
        const districtVal = rows[6][2];
        const stateVal = rows[6][3];
        const phoneVal = rows[6][4];

        // F1 => catalogue
        const catalogueVal = rows[0][5];

        // D2 => price
        const priceVal = rows[1][3];

        // G1 => pdf link
        const pdfVal = rows[0][6];

        // Prefill
        document.getElementById("sno").value = snoVal || "";
        document.getElementById("party").value = partyVal || "";
        document.getElementById("district").value = districtVal || "";
        document.getElementById("state").value = stateVal || "";
        document.getElementById("phone").value = phoneVal || "";
        document.getElementById("catalogue").value = catalogueVal || "";
        document.getElementById("price").value = priceVal || "";

        if (pdfVal) {
          document.getElementById("pdf-frame").src = pdfVal;
          document.getElementById("pdf-link").href = pdfVal;
        }
      } catch (err) {
        console.error("Error loading sheet data", err);
      }
    }

    // Override with URL params if present
    function loadParams() {
      const params = new URLSearchParams(window.location.search);
      if (params.get("sno")) document.getElementById("sno").value = params.get("sno");
      if (params.get("party")) document.getElementById("party").value = params.get("party");
      if (params.get("district")) document.getElementById("district").value = params.get("district");
      if (params.get("state")) document.getElementById("state").value = params.get("state");
      if (params.get("phone")) document.getElementById("phone").value = params.get("phone");
      if (params.get("catalogue")) document.getElementById("catalogue").value = params.get("catalogue");
      if (params.get("price")) document.getElementById("price").value = params.get("price");
      if (params.get("pdf")) {
        document.getElementById("pdf-frame").src = params.get("pdf");
        document.getElementById("pdf-link").href = params.get("pdf");
      }
    }

    // On page load
    (async function init() {
      await loadSheetData();
      loadParams(); // Override with URL params if given
    })();

    // Submit handler
    document.getElementById("orderForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const response = await fetch(SUBMIT_URL, { method: "POST", body: formData });
      if (response.ok) {
        alert("‚úÖ Order submitted successfully!");
        this.reset();
      } else {
        alert("‚ùå Something went wrong. Try again.");
      }
    });
  </script>
</body>
</html>
